const num_ports : usize = 6;
const num_ports_padded : usize = num_ports;
const up_port : usize = 5;

#[derive(Default,Copy,Clone)]
pub struct R_Params {
}

#[repr(align(16))]
#[derive(Copy,Clone)]
pub struct R_Vars {
    pub S: [f32; num_ports * num_ports],
}

impl Default for R_Vars {
    fn default() -> Self {
        Self {
            S: [0.0; num_ports * num_ports],
        }
    }
}

#[derive(Default,Copy,Clone)]
pub struct R_State {
    b_up: f32,
}

#[allow(unused_variables)]
pub fn update_vars(vars: &mut R_Vars,
                   params: R_Params,
                   Ra: f32,
                   Ga: f32,
                   Rb: f32,
                   Gb: f32,
                   Rc: f32,
                   Gc: f32,
                   Rd: f32,
                   Gd: f32,
                   Re: f32,
                   Ge: f32) -> f32
{
    let S_transpose: [[f32; num_ports]; num_ports] = [
        [-((Ra * Ra * Rb + Ra * Ra * Rc - Rb * Rc * Rc) * Rd * Rd - (Rb * Rb * Rc + Rb * Rc * Rc + Rb * Rd * Rd + (Rb * Rb + 2.0 * Rb * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + 2.0 * Ra * Ra * Rb * Rc + (Ra * Ra - Rb * Rb) * Rc * Rc) * Rd + (Ra * Ra * Rb * Rb + 2.0 * Ra * Ra * Rb * Rc + (Ra * Ra - Rb * Rb) * Rc * Rc + (Ra * Ra - 2.0 * Rb * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb - Rb * Rc * Rc + (Ra * Ra - Rb * Rb) * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), -((Ra * Ra * Rc + Ra * Rc * Rc) * Rd * Rd + (Ra * Rb * Rc + Ra * Rc * Rc + Ra * Rd * Rd + (Ra * Rb + 2.0 * Ra * Rc) * Rd) * Re * Re + 2.0 * (Ra * Ra * Rb * Rc + (Ra * Ra + Ra * Rb) * Rc * Rc) * Rd + (2.0 * Ra * Ra * Rb * Rc + 2.0 * (Ra * Ra + Ra * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rc) * Rd * Rd + (Ra * Ra * Rb + 2.0 * Ra * Rc * Rc + 3.0 * (Ra * Ra + Ra * Rb) * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), ((2.0 * Ra * Ra * Rb + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + Ra * Rb * Rc + Ra * Rb * Rd) * Re * Re + 2.0 * (Ra * Ra * Rb * Rb + (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (2.0 * Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + (3.0 * Ra * Ra * Rb + 2.0 * Ra * Rb * Rb + (Ra * Ra + 3.0 * Ra * Rb) * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), -((Ra * Rb * Rb + Ra * Rb * Rc + Ra * Rb * Rd) * Re * Re - (Ra * Ra * Rb * Rc + (Ra * Ra + Ra * Rb) * Rc * Rc) * Rd + (Ra * Ra * Rb * Rb + Ra * Rb * Rb * Rc - (Ra * Ra + Ra * Rb) * Rc * Rc + (Ra * Ra * Rb - Ra * Ra * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), ((2.0 * Ra * Ra * Rb + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (2.0 * Ra * Ra * Rb * Rb + (Ra * Ra + Ra * Rb) * Rc * Rc + (3.0 * Ra * Ra * Rb + 2.0 * Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + Ra * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rd * Rd + (2.0 * Ra * Ra * Rb + Ra * Rb * Rb) * Rc + (2.0 * Ra * Ra * Rb + 2.0 * Ra * Rb * Rb + (2.0 * Ra * Ra + 3.0 * Ra * Rb) * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), -(Ra * Rc * Rd + (Ra * Rb + Ra * Rc + Ra * Rd) * Re) / ((Ra * Rb + (Ra + Rb) * Rc) * Rd + (Ra * Rb + (Ra + Rb) * Rc + (Ra + Rb) * Rd) * Re)],
        [-((Ra * Rb * Rc + Rb * Rc * Rc) * Rd * Rd + (Rb * Rb * Rc + Rb * Rc * Rc + Rb * Rd * Rd + (Rb * Rb + 2.0 * Rb * Rc) * Rd) * Re * Re + 2.0 * (Ra * Rb * Rb * Rc + (Ra * Rb + Rb * Rb) * Rc * Rc) * Rd + (2.0 * Ra * Rb * Rb * Rc + 2.0 * (Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Rb + 2.0 * Rb * Rc) * Rd * Rd + (Ra * Rb * Rb + 2.0 * Rb * Rc * Rc + 3.0 * (Ra * Rb + Rb * Rb) * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), ((Ra * Ra * Rc + Ra * Rc * Rc) * Rd * Rd - (Ra * Rb * Rb + Rb * Rb * Rc - Ra * Rc * Rc - Ra * Rd * Rd + (Rb * Rb - 2.0 * Ra * Rc) * Rd) * Re * Re - (Ra * Ra * Rb * Rb + 2.0 * Ra * Rb * Rb * Rc - (Ra * Ra - Rb * Rb) * Rc * Rc) * Rd - (Ra * Ra * Rb * Rb + 2.0 * Ra * Rb * Rb * Rc - (Ra * Ra - Rb * Rb) * Rc * Rc - (Ra * Ra + 2.0 * Ra * Rc) * Rd * Rd + 2.0 * (Ra * Rb * Rb - Ra * Rc * Rc - (Ra * Ra - Rb * Rb) * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), -((Ra * Ra * Rb + Ra * Rb * Rc) * Rd * Rd + (2.0 * Ra * Rb * Rb + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb) * Rd) * Re * Re + 2.0 * (Ra * Ra * Rb * Rb + (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (2.0 * Ra * Ra * Rb * Rb + Ra * Rb * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + (2.0 * Ra * Ra * Rb + 3.0 * Ra * Rb * Rb + (3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), ((2.0 * Ra * Rb * Rb + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra * Rb + 2.0 * Ra * Rb * Rb) * Rc) * Rd + (2.0 * Ra * Ra * Rb * Rb + (Ra * Rb + Rb * Rb) * Rc * Rc + (2.0 * Ra * Ra * Rb + 3.0 * Ra * Rb * Rb) * Rc + (2.0 * Ra * Ra * Rb + 2.0 * Ra * Rb * Rb + (3.0 * Ra * Rb + 2.0 * Rb * Rb) * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), -((Ra * Ra * Rb + Ra * Rb * Rc) * Rd * Rd + (Ra * Ra * Rb * Rb + Ra * Ra * Rb * Rc - (Ra * Rb + Rb * Rb) * Rc * Rc) * Rd - (Ra * Rb * Rb * Rc - Ra * Rb * Rd * Rd + (Ra * Rb + Rb * Rb) * Rc * Rc - (Ra * Rb * Rb - Rb * Rb * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), -((Ra * Rb + Rb * Rc) * Rd + (Rb * Rc + Rb * Rd) * Re) / ((Ra * Rb + (Ra + Rb) * Rc) * Rd + (Ra * Rb + (Ra + Rb) * Rc + (Ra + Rb) * Rd) * Re) ],
        [((2.0 * Ra * Rb * Rc + (Ra + 2.0 * Rb) * Rc * Rc) * Rd * Rd + (Rb * Rb * Rc + Rb * Rc * Rc + Rb * Rc * Rd) * Re * Re + 2.0 * (Ra * Rb * Rb * Rc + (Ra * Rb + Rb * Rb) * Rc * Rc) * Rd + (2.0 * Ra * Rb * Rb * Rc + (Ra + 2.0 * Rb) * Rc * Rd * Rd + 2.0 * (Ra * Rb + Rb * Rb) * Rc * Rc + ((Ra + 3.0 * Rb) * Rc * Rc + (3.0 * Ra * Rb + 2.0 * Rb * Rb) * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), -((Ra * Ra * Rc + Ra * Rc * Rc) * Rd * Rd + (2.0 * Ra * Rb * Rc + (2.0 * Ra + Rb) * Rc * Rc + (2.0 * Ra + Rb) * Rc * Rd) * Re * Re + 2.0 * (Ra * Ra * Rb * Rc + (Ra * Ra + Ra * Rb) * Rc * Rc) * Rd + (2.0 * Ra * Ra * Rb * Rc + Ra * Rc * Rd * Rd + 2.0 * (Ra * Ra + Ra * Rb) * Rc * Rc + ((3.0 * Ra + Rb) * Rc * Rc + (2.0 * Ra * Ra + 3.0 * Ra * Rb) * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), ((Ra * Ra * Rb - (Ra + Rb) * Rc * Rc) * Rd * Rd + (Ra * Rb * Rb - (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rd) * Re * Re + (Ra * Ra * Rb * Rb - (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc) * Rd + (Ra * Ra * Rb * Rb - (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb - (Ra + Rb) * Rc * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), ((2.0 * (Ra + Rb) * Rc * Rc + 2.0 * (Ra + Rb) * Rc * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc) * Re * Re + (Ra * Ra * Rb * Rc + (Ra * Ra + Ra * Rb) * Rc * Rc) * Rd + ((2.0 * Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (2.0 * Ra * Ra * Rb + Ra * Rb * Rb) * Rc + (2.0 * (Ra + Rb) * Rc * Rc + (2.0 * Ra * Ra + 3.0 * Ra * Rb) * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), -((2.0 * (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + ((Ra * Ra + 3.0 * Ra * Rb + 2.0 * Rb * Rb) * Rc * Rc + (Ra * Ra * Rb + 2.0 * Ra * Rb * Rb) * Rc) * Rd + (Ra * Rb * Rb * Rc + 2.0 * (Ra + Rb) * Rc * Rd * Rd + (Ra * Rb + Rb * Rb) * Rc * Rc + (2.0 * (Ra + Rb) * Rc * Rc + (3.0 * Ra * Rb + 2.0 * Rb * Rb) * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), -(Ra * Rc * Rd - Rb * Rc * Re) / ((Ra * Rb + (Ra + Rb) * Rc) * Rd + (Ra * Rb + (Ra + Rb) * Rc + (Ra + Rb) * Rd) * Re) ],
        [((Ra * Rb * Rc + (Ra + Rb) * Rc * Rc) * Rd * Rd - (Rb * Rd * Rd + (Rb * Rb + Rb * Rc) * Rd) * Re * Re - ((Ra * Rb - Ra * Rc) * Rd * Rd + (Ra * Rb * Rb + Rb * Rb * Rc - (Ra + Rb) * Rc * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + ((2.0 * Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + (2.0 * Ra + Rb) * Rc) * Rd) * Re * Re + ((2.0 * Ra * Ra + 2.0 * Ra * Rb + (3.0 * Ra + 2.0 * Rb) * Rc) * Rd * Rd + (2.0 * Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (2.0 * Ra * Ra + 3.0 * Ra * Rb) * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), ((Ra * Ra * Rb + (Ra * Ra + Ra * Rb) * Rc) * Rd * Rd + (2.0 * (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + ((2.0 * Ra * Ra + 3.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + (2.0 * Ra * Ra * Rb + Ra * Rb * Rb + (2.0 * Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), -((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd - (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc - (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc) * Re * Re - (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc - (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), -((Ra * Ra * Rb + 2.0 * (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + ((Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + 2.0 * (Ra + Rb) * Rc * Rc + (3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), -(Rb * Rd * Re + (Ra * Rb + (Ra + Rb) * Rc) * Rd) / ((Ra * Rb + (Ra + Rb) * Rc) * Rd + (Ra * Rb + (Ra + Rb) * Rc + (Ra + Rb) * Rd) * Re) ],
        [((Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + 2.0 * Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + 2.0 * Rb * Rb + (2.0 * Ra + 3.0 * Rb) * Rc) * Rd) * Re * Re + ((2.0 * Ra * Rb + (Ra + 2.0 * Rb) * Rc) * Rd * Rd + (2.0 * Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (3.0 * Ra * Rb + 2.0 * Rb * Rb) * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), ((Ra * Rb * Rc + (Ra + Rb) * Rc * Rc - Ra * Rd * Rd - (Ra * Rb - Rb * Rc) * Rd) * Re * Re - ((Ra * Ra + Ra * Rc) * Rd * Rd + (Ra * Ra * Rb + Ra * Ra * Rc - (Ra + Rb) * Rc * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), -((Ra * Rb * Rb + 2.0 * (Ra + Rb) * Rd * Rd + (Ra * Rb + Rb * Rb) * Rc + (3.0 * Ra * Rb + 2.0 * Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + ((Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + (Ra * Ra * Rb + 2.0 * Ra * Rb * Rb + (Ra * Ra + 3.0 * Ra * Rb + 2.0 * Rb * Rb) * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), -((Ra * Rb * Rb + 2.0 * (Ra + Rb) * Rc * Rc + (3.0 * Ra * Rb + Rb * Rb) * Rc + (Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + (Ra * Ra * Rb + 2.0 * (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb) * Rc) * Rd) * Re) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd - (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd) / ((Ra * Ra * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb) * Rc) * Rd * Rd + (Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra + Rb) * Rd * Rd + (2.0 * Ra * Rb + Rb * Rb) * Rc + (2.0 * Ra * Rb + Rb * Rb + 2.0 * (Ra + Rb) * Rc) * Rd) * Re * Re + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc) * Rd + (Ra * Ra * Rb * Rb + (Ra * Ra + 2.0 * Ra * Rb + Rb * Rb) * Rc * Rc + (Ra * Ra + 2.0 * Ra * Rb + 2.0 * (Ra + Rb) * Rc) * Rd * Rd + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb) * Rc + 2.0 * (Ra * Ra * Rb + Ra * Rb * Rb + (Ra + Rb) * Rc * Rc + (Ra * Ra + 3.0 * Ra * Rb + Rb * Rb) * Rc) * Rd) * Re), -(Ra * Rb + (Ra + Rb) * Rc + Ra * Rd) * Re / ((Ra * Rb + (Ra + Rb) * Rc) * Rd + (Ra * Rb + (Ra + Rb) * Rc + (Ra + Rb) * Rd) * Re) ],
        [-(Rc * Rd + (Rb + Rc + Rd) * Re) / (Ra * Rb + (Ra + Rb) * Rc + (Ra + Rc) * Rd + (Rb + Rc + Rd) * Re), -((Ra + Rc) * Rd + (Rc + Rd) * Re) / (Ra * Rb + (Ra + Rb) * Rc + (Ra + Rc) * Rd + (Rb + Rc + Rd) * Re), -(Ra * Rd - Rb * Re) / (Ra * Rb + (Ra + Rb) * Rc + (Ra + Rc) * Rd + (Rb + Rc + Rd) * Re), -(Ra * Rb + (Ra + Rb) * Rc + Rb * Re) / (Ra * Rb + (Ra + Rb) * Rc + (Ra + Rc) * Rd + (Rb + Rc + Rd) * Re), -(Ra * Rb + (Ra + Rb) * Rc + Ra * Rd) / (Ra * Rb + (Ra + Rb) * Rc + (Ra + Rc) * Rd + (Rb + Rc + Rd) * Re), 0.0],
    ];

    for c in 0..num_ports {
        for r in 0..num_ports {
            vars.S[r * num_ports_padded + c] = S_transpose[c][r];
        }
    }

    let Rf = ((Ra * Rb + (Ra + Rb) * Rc) * Rd + (Ra * Rb + (Ra + Rb) * Rc + (Ra + Rb) * Rd) * Re) / (Ra * Rb + (Ra + Rb) * Rc + (Ra + Rc) * Rd + (Rb + Rc + Rd) * Re);
    return Rf;
}

#[allow(unused_variables)]
pub fn reflected(vars: &R_Vars, state: &mut R_State, a: &[f32; num_ports-1]) -> f32
{
    return state.b_up;
}

#[allow(unused_variables)]
pub fn incident(vars: &R_Vars, state: &mut R_State, a_up: f32, a_in: &[f32; num_ports-1], b_out: &mut [f32; num_ports-1])
{
    let mut a : [f32; num_ports] = [0.0; num_ports];
    let mut b : [f32; num_ports_padded] = [0.0; num_ports_padded];

    let mut j = 0;
    for it in 0..num_ports {
        if it == up_port {
            a[it] = a_up;
        } else {
            a[it] = a_in[j];
            j += 1;
        }
    }

    for c in 0..num_ports {
        b[c] = vars.S[c] * a[0];
        for r in 1..num_ports {
            b[c] += vars.S[r * num_ports_padded + c] * a[r];
        }
    }

    j = 0;
    for i in 0..num_ports {
        if i == up_port {
            state.b_up = b[i];
        } else {
            b_out[j] = b[i];
            j += 1;
        }
    }
}
